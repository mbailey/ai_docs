# LiveKit MCP Integration Guide

This document consolidates all research findings on LiveKit MCP (Model Context Protocol) integration, including available servers, patterns, and implementation guidance.

## Overview

While LiveKit doesn't have built-in MCP support, several implementations and patterns exist for integrating MCP with LiveKit for voice applications. This guide covers:

1. Available MCP servers for LiveKit
2. Integration patterns and architectures
3. Implementation recommendations for voice-mcp
4. Future possibilities including sandbox automation

## Available LiveKit MCP Servers

### 1. Pipedream LiveKit MCP Server

**URL**: https://mcp.pipedream.com/app/livekit

**Key Features**:
- Token generation for participants
- Room management (list, create, delete)
- Participant management
- Ingress creation from URLs
- Built-in user authentication

**Benefits for voice-mcp**:
- Eliminates need to expose API secrets in client applications
- Provides server-side token generation
- Simplifies room management for multi-device access

**Integration Example**:
```javascript
import { RoomServiceClient } from 'livekit-server-sdk';
export default defineComponent({
  props: {
    livekit: {
      type: "app",
      app: "livekit",
    }
  },
  async run({steps, $}) {
    const svc = new RoomServiceClient(
      this.livekit.$auth.project_url,
      this.livekit.$auth.api_key,
      this.livekit.$auth.secret_key);
    return await svc.listRooms();
  },
})
```

### 2. LiveKit Basic MCP Example

**Repository**: https://github.com/livekit-examples/basic-mcp

**Architecture**:
- Main agent implementation in `agent.py`
- MCP client directory structure:
  - `server.py`: MCP server connection handlers
  - `agent_tools.py`: MCP tool integration
  - `util.py`: Utility functions

**Technology Stack**:
- Python 3.9+
- Deepgram for STT
- OpenAI GPT-4o for NLP
- OpenAI for TTS
- Silero for voice activity detection

**Benefits for voice-mcp**:
- Reference implementation for MCP tool integration
- Shows pattern for bridging MCP with LiveKit agents
- Modular architecture that could be adapted

### 3. Home Assistant MCP Agent

**Repository**: https://github.com/longcw/home-assistant-mcp-agent

**Features**:
- Integrates LiveKit Agents with Home Assistant MCP
- Voice control for smart home devices
- Real-time audio/video communication with AI assistants

**Benefits for voice-mcp**:
- Demonstrates MCP-to-LiveKit function calling bridge
- Shows pattern for integrating external services
- Could inspire similar integrations for voice-mcp

## Integration Patterns

### Token Generation Pattern

Instead of exposing LiveKit API secrets in client configurations, use a server-side MCP to generate tokens:

1. Client requests token from MCP server
2. MCP server validates request
3. MCP server generates LiveKit token with appropriate permissions
4. Client uses token to join LiveKit room

### MCP Tool Bridge Pattern

Since LiveKit doesn't have native MCP support, bridging is required:

1. MCP server exposes tools via JSON schema
2. Bridge layer converts MCP tools to LiveKit-compatible functions
3. LiveKit agent can call these functions during voice interactions

## Recommendations for voice-mcp

### 1. Implement Token Generation Service

Consider adding an optional token generation endpoint that:
- Accepts room name and participant identity
- Returns signed JWT token
- Removes need for API secrets in client configs

### 2. Create MCP Tool Registry

Allow voice-mcp to discover and use other MCP servers:
- Query available MCP tools at startup
- Convert to LiveKit-compatible functions
- Enable voice control of any MCP service

### 3. Add Room Management Features

Implement basic room management:
- Auto-create rooms when needed
- Clean up empty rooms
- List active rooms and participants

## Implementation Notes

### Security Considerations

- Never expose LiveKit API secrets in client applications
- Use server-side token generation
- Implement proper authentication for token requests
- Set appropriate token permissions and expiry

### Scalability Considerations

- Room management becomes important at scale
- Consider implementing room pooling
- Monitor and clean up unused rooms
- Implement rate limiting for token generation

## Future Research

- Investigate LiveKit Agents framework deeper
- Explore more MCP server implementations
- Study WebRTC optimization techniques
- Research voice activity detection improvements

## LiveKit Cloud Sandbox Automation

### Current Limitations

LiveKit Cloud sandboxes are currently created through the web UI. The sandbox IDs (e.g., `responsive-widget-2oem2j`) are:
- Generated by LiveKit Cloud when clicking "Run in sandbox"
- Unique for each sandbox instance
- Not user-definable
- Temporary and auto-deleted after inactivity

### Potential Automation Approaches

#### 1. LiveKit CLI Extension

The `lk` CLI might support sandbox creation programmatically:
```bash
# Hypothetical command (needs verification)
lk sandbox create --template voice-assistant
```

This would need to be wrapped in an MCP tool.

#### 2. LiveKit Cloud API

If LiveKit provides a Cloud Management API, we could:
- Create sandboxes programmatically
- Get sandbox credentials automatically
- Delete sandboxes when done

#### 3. Browser Automation

As a fallback, browser automation could:
- Navigate to LiveKit Cloud
- Click "Run in sandbox"
- Extract the generated sandbox ID
- Return credentials to the user

### Implementation Proposal for livekit-admin-mcp

```python
@mcp.tool()
async def create_cloud_sandbox(template: str = "voice-assistant-frontend") -> str:
    """Create a LiveKit Cloud sandbox and return connection details"""
    # Option 1: Shell out to lk CLI
    result = subprocess.run(
        ["lk", "sandbox", "create", "--template", template],
        capture_output=True
    )
    
    # Parse sandbox ID and credentials from output
    # Return formatted connection details
```

## Current voice-mcp MCP Servers

### 1. voice-mcp

**Location**: `python-package/src/voice_mcp/scripts/voice-mcp`

**Tools**:
- `converse`: Have voice conversations
- `listen_for_speech`: Convert speech to text
- `check_room_status`: Check LiveKit room status
- `check_audio_devices`: List audio devices

### 2. livekit-admin-mcp

**Location**: `mcp-servers/livekit-admin-mcp`

**Tools**:
- `create_room`: Create LiveKit rooms
- `list_rooms`: List active rooms
- `get_room_info`: Get room details
- `delete_room`: Delete rooms
- `create_participant_token`: Generate access tokens
- `remove_participant`: Remove participants

**Enhancement Opportunities**:
- Add cloud sandbox creation
- Add room template support
- Add bulk operations

## Integration Architecture

### Current Architecture
```
Claude <-> MCP Protocol <-> voice-mcp <-> LiveKit Server
                        \-> livekit-admin-mcp <-/
```

### Proposed Enhanced Architecture
```
Claude <-> MCP Protocol <-> voice-mcp <-> LiveKit Server/Cloud
                        \-> livekit-admin-mcp <-> LiveKit Cloud API
                         \-> other-mcp-servers <-> External Services
```

## Resources

- [LiveKit Token Generation Docs](https://docs.livekit.io/home/server/generating-tokens/)
- [MCP Specification](https://github.com/modelcontextprotocol/specification)
- [LiveKit Agents Documentation](https://docs.livekit.io/agents/)
- [Pipedream MCP Documentation](https://pipedream.com/docs/connect/mcp/)
- [LiveKit CLI Documentation](https://docs.livekit.io/home/cli/)
- [LiveKit Cloud API Docs](https://docs.livekit.io/home/cloud/api/) (if available)